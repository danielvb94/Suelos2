<?php

    $file_path = basename( $_FILES['uploaded_file']['name']);

    $file_path = cambiarNombre($file_path);

    if(move_uploaded_file($_FILES['uploaded_file']['tmp_name'], $file_path) ){

      $file_path = "'" . $file_path . "'";
      $archivo = preg_replace("/\..*/",".txt'",$file_path);

      //exec('matlab -wait -nodisplay -nosplash -nodesktop -r "Fuzzy2("'.$file_path.'");quit;"');
      exec('matlab -wait -nosplash -nojvm -noFigureWindows -r "Fuzzy2("'.$file_path.'","'.$archivo.'");quit;"');

      $archivo = str_replace("'","",$archivo);
      $c = file_get_contents("C:\\xampp\\htdocs\\tfg\\ficheros\\".$archivo);

      $chip = [
		"2.5Y8/8" => 1,	//2.5Y
		"2.5Y8/6" => 2,
		"2.5Y8/4" => 3,
		"2.5Y8/3" => 4,
		"2.5Y8/2" => 5,
		"2.5Y8/1" => 6,
		"2.5Y7/8" => 7,
		"2.5Y7/6" => 8,
		"2.5Y7/4" => 9,
		"2.5Y7/3" => 10,
		"2.5Y7/2" => 11,
		"2.5Y7/1" => 12,
		"2.5Y6/8" => 13,
		"2.5Y6/6" => 14,
		"2.5Y6/4" => 15,
		"2.5Y6/3" => 16,
		"2.5Y6/2" => 17,
		"2.5Y6/1" => 18,
		"2.5Y5/6" => 19,
		"2.5Y5/4" => 20,
		"2.5Y5/3" => 21,
		"2.5Y5/2" => 22,
		"2.5Y5/1" => 23,
		"2.5Y4/4" => 24,
		"2.5Y4/3" => 25,
		"2.5Y4/2" => 26,
		"2.5Y4/1" => 27,
		"2.5Y3/3" => 28,
		"2.5Y3/2" => 29,
		"2.5Y3/1" => 30,
		"2.5Y2.5/1" => 31, //2.5Y
		"2.5YR8/4" => 32,	//2.5YR
		"2.5YR8/3" => 33,
		"2.5YR8/1" => 34,
		"2.5YR7/8" => 35,
		"2.5YR7/6" => 36,
		"2.5YR7/5" => 37,
		"2.5YR7/4" => 38,
		"2.5YR7/3" => 39,
		"2.5YR7/2" => 40,
		"2.5YR7/1" => 41,
		"2.5YR6/8" => 42,
		"2.5YR6/6" => 43,
		"2.5YR6/4" => 44,
		"2.5YR6/3" => 45,
		"2.5YR6/2" => 46,
		"2.5YR6/1" => 47,
		"2.5YR5/8" => 48,
		"2.5YR5/6" => 49,
		"2.5YR5/4" => 50,
		"2.5YR5/3" => 51,
		"2.5YR5/2" => 52,
		"2.5YR5/1" => 53,
		"2.5YR4/8" => 54,
		"2.5YR4/6" => 55,
		"2.5YR4/4" => 56,
		"2.5YR4/3" => 57,
		"2.5YR4/2" => 58,
		"2.5YR4/1" => 59,
		"2.5YR3/6" => 60,
		"2.5YR3/4" => 61,
		"2.5YR3/3" => 62,
		"2.5YR3/2" => 63,
		"2.5YR3/1" => 64,
		"2.5YR2.5/4" => 65,
		"2.5YR2.5/3" => 66,
		"2.5YR2.5/2" => 67,
		"2.5YR2.5/1" => 68, //2.5YR
		"5Y8/8" => 69,		//5Y
		"5Y8/6" => 70,
		"5Y8/4" => 71,
		"5Y8/3" => 72,
		"5Y8/2" => 73,
		"5Y8/1" => 74,
		"5Y7/8" => 75,
		"5Y7/6" => 76,
		"5Y7/4" => 77,
		"5Y7/3" => 78,
		"5Y7/2" => 79,
		"5Y7/1" => 80,
		"5Y6/8" => 81,
		"5Y6/6" => 82,
		"5Y6/4" => 83,
		"5Y6/3" => 84,
		"5Y6/2" => 85,
		"5Y6/1" => 86,
		"5Y5/6" => 87,
		"5Y5/4" => 88,
		"5Y5/3" => 89,
		"5Y5/2" => 90,
		"5Y5/1" => 91,
		"5Y4/4" => 92,
		"5Y4/3" => 93,
		"5Y4/2" => 94,
		"5Y4/1" => 95,
		"5Y3/2" => 96,
		"5Y3/1" => 97,
		"5Y2.5/2" => 98,
		"5Y2.5/1" => 99,   //5Y
		"5YR8/4" => 100,	//5YR
		"5YR8/3" => 101,
		"5YR8/2" => 102,
		"5YR8/1" => 103,
		"5YR7/8" => 104,
		"5YR7/6" => 105,
		"5YR7/4" => 106,
		"5YR7/3" => 107,
		"5YR7/2" => 108,
		"5YR7/1" => 109,
		"5YR6/8" => 110,
		"5YR6/6" => 111,
		"5YR6/4" => 112,
		"5YR6/3" => 113,
		"5YR6/2" => 114,
		"5YR6/1" => 115,
		"5YR5/8" => 116,
		"5YR5/6" => 117,
		"5YR5/4" => 118,
		"5YR5/3" => 119,
		"5YR5/2" => 120,
		"5YR5/1" => 121,
		"5YR4/6" => 122,
		"5YR4/4" => 123,
		"5YR4/3" => 124,
		"5YR4/2" => 125,
		"5YR4/1" => 126,
		"5YR3/4" => 127,
		"5YR3/3" => 128,
		"5YR3/2" => 129,
		"5YR3/1" => 130,
		"5YR2.5/2" => 131,
		"5YR2.5/1" => 132,   //5YR
		"7.5YR8/6" => 133,   //7.5YR
		"7.5YR8/4" => 134,
		"7.5YR8/3" => 135,
		"7.5YR8/2" => 136,
		"7.5YR8/1" => 137,
		"7.5YR7/8" => 138,
		"7.5YR7/6" => 139,
		"7.5YR7/4" => 140,
		"7.5YR7/3" => 141,
		"7.5YR7/2" => 142,
		"7.5YR7/1" => 143,
		"7.5YR6/8" => 144,
		"7.5YR6/6" => 145,
		"7.5YR6/4" => 146,
		"7.5YR6/3" => 147,
		"7.5YR6/2" => 148,
		"7.5YR6/1" => 149,
		"7.5YR5/8" => 150,
		"7.5YR5/6" => 151,
		"7.5YR5/4" => 152,
		"7.5YR5/3" => 153,
		"7.5YR5/2" => 154,
		"7.5YR5/1" => 155,
		"7.5YR4/6" => 156,
		"7.5YR4/4" => 157,
		"7.5YR4/3" => 158,
		"7.5YR4/2" => 159,
		"7.5YR4/1" => 160,
		"7.5YR3/4" => 161,
		"7.5YR3/3" => 162,
		"7.5YR3/2" => 163,
		"7.5YR3/1" => 164,
		"7.5YR2.5/3" => 165,
		"7.5YR2.5/2" => 166,
		"7.5YR2.5/1" => 167,   //7.5YR
		"10R8/4" => 168,	//10R
		"10R8/3" => 169,
		"10R8/2" => 170,
		"10R8/1" => 171,
		"10R7/8" => 172,
		"10R7/6" => 173,
		"10R7/4" => 174,
		"10R7/3" => 175,
		"10R7/2" => 176,
		"10R7/1" => 177,
		"10R6/8" => 178,
		"10R6/6" => 179,
		"10R6/4" => 180,
		"10R6/3" => 181,
		"10R6/2" => 182,
		"10R6/1" => 183,
		"10R5/8" => 184,
		"10R5/6" => 185,
		"10R5/4" => 186,
		"10R5/3" => 187,
		"10R5/2" => 188,
		"10R5/1" => 189,
		"10R4/8" => 190,
		"10R4/6" => 191,
		"10R4/4" => 192,
		"10R4/3" => 193,
		"10R4/2" => 194,
		"10R4/1" => 195,
		"10R3/6" => 196,
		"10R3/4" => 197,
		"10R3/3" => 198,
		"10R3/2" => 199,
		"10R3/1" => 200,
		"10R2.5/2" => 201,
		"10R2.5/1" => 202,   //10R
		"10YR8/8" => 203,	//10YR
		"10YR8/6" => 204,
		"10YR8/4" => 205,
		"10YR8/3" => 206,
		"10YR8/2" => 207,
		"10YR8/1" => 208,
		"10YR7/8" => 209,
		"10YR7/6" => 210,
		"10YR7/4" => 211,
		"10YR7/3" => 212,
		"10YR7/2" => 213,
		"10YR7/1" => 214,
		"10YR6/8" => 215,
		"10YR6/6" => 216,
		"10YR6/4" => 217,
		"10YR6/3" => 218,
		"10YR6/2" => 219,
		"10YR6/1" => 220,
		"10YR5/8" => 221,
		"10YR5/6" => 222,
		"10YR5/4" => 223,
		"10YR5/3" => 224,
		"10YR5/2" => 225,
		"10YR5/1" => 226,
		"10YR4/6" => 227,
		"10YR4/4" => 228,
		"10YR4/3" => 229,
		"10YR4/2" => 230,
		"10YR4/1" => 231,
		"10YR3/6" => 232,
		"10YR3/4" => 233,
		"10YR3/3" => 234,
		"10YR3/2" => 235,
		"10YR3/1" => 236,
		"10YR2/2" => 237,
		"10YR2/1" => 238,	//10YR
	];

	//$c = file_get_contents("C:\\xampp\\htdocs\\tfg\\ficheros\\pic_20163304063331.txt");

	$array = explode("  ", $c, -1);

	arsort($array);
	//print_r($array);



foreach ($array as $clave => $valor ) {
	if($valor > 0.01) {
		$valor = $valor*100;
		$salida = array_search($clave,$chip);
		print "$salida _ ($valor%) -";
	}
}
	  
    } else{
        echo "Error subiendo imagen";
    }

    function cambiarNombre($ruta){
      $extension = ".".substr(strrchr($ruta,'.'),1);
      $original_nombre = preg_replace("/\..*/","",$ruta);
      $actual_nombre = $original_nombre;

      $i = 1;
      while(file_exists($actual_nombre.$extension))
      {
        $actual_nombre = (string)$original_nombre.$i;
        $file_path = $actual_nombre.$extension;
        $i++;
      }
      return $ruta;
    }

	
	function decision($c){
		$c = intval($c);

		if($c<32){
			$c="2.5Y";
		} else if($c>31 && $c<69){
			//2.5YR
			$c="2.5YR";
		} else if($c>68 && $c<100){
			//5Y
			$c="5Y";
		} else if($c>99 && $c<133){
			//5YR
			$c="5YR";
		} else if($c>132 && $c<168){
			//7.5YR
			$c="7.5YR";
		} else if($c>167 && $c<203){
			//10R
			$c="10R";
		} else if($c>202){
			//10YR
			$c="10YR";
		}
		return $c;
	}
	
?>
